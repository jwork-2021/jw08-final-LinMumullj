# 补交的网络编程作业
因为缺少插图，所以就在网上找了坦克大战的图片资源。花了几天几夜写了一份看得懂的坦克大战游戏（因为考虑到其实和之前的葫芦娃游戏一样是移动射击游戏，所以就而且插图易找），能够实现网络编程。

话不多说，视频里说的比较清楚：

B站视频：https://www.bilibili.com/video/BV1q34y1B7ds?share_source=copy_web

**想吐槽网络编程DEBUG最大的一个关键点：**
在我认为实现好信息交流的时候，出现了一个非常怪异的现象。我的调试信息显示在我服务端writeobject的时候，地图信息正确。但当我在客户端读取到信息的时候，打印出来却永远是静止的界面，换句话说，每一次readobject到的对象的信息都是相同的。我查了大量资料，终于解决：

就是我用writeObject方法循环向socket写全局信息的时候，有可能被认定为写的是相同数据。导致后续内容发布出去。对同一个共享对象做重复性的多次写入那就可以使用writeObject + reset方法 组合使用 做重置动作 (即深克隆效果)。

**另外最大的感悟就是：**
网络编程还是比较需要耐心和细心的，必须服务端客户端对照着写，每一个socket，每一个流，每一个线程都要管控得当。不要让他们乱成一团麻，可以画一个管道图或者步骤图来理清思路。

# myTankWar 项目介绍

**191220059 林龙杰**

## 实现思路

**玩法思路**

实现这个经典玩法的思路很简单。游戏要达到的目标是能够有开始界面，进入游戏后可以操控主角进行移动射击，敌方坦克会进行自动移动射击，有边界箱子等不可穿越的地形。主角与敌人都有生命值，生命值消耗完后会死亡，消灭敌方坦克会获得积分。

游戏还可以进行保存和加载。

游戏也能进行网络双人对战。需要开启服务端程序，并开启两个用户端程序进入双人游戏界面。开始游戏后两个玩家的界面保持一致，并可以操控自己的角色参与战斗。

**实现思路**

开始界面用继承JFram的框架来开启游戏，其中装载了集成JPanel的画板。所有的坦克，子弹，地形等需要绘制的元素均是画板的属性。在开始界面监听键盘进行模式选择，在画板中监听键盘进行主角按键操控。

单机部分：JPanel实现Runnable接口不断进行重绘。重绘的内容为：地图和积分界面，我方敌方坦克，子弹，爆炸等。构造JPanel时生成坦克，敌方坦克同样为线程，不断地随机移动，发射子弹。子弹也会线程，朝着发射时的防线不断移动。最后注意实现碰撞检测，比如坦克与坦克之间，坦克与地形之间的碰撞，以及子弹与地形和坦克之间碰撞。坦克死后会留下爆炸，爆炸同样为线程，配合paint函数完成动态的爆炸效果。最后实现保存和加载功能，利用序列化和反序列化保存和加载地图。

网络部分：编写客户端和服务器端。服务器端运行游戏逻辑，客户端负责绘制游戏界面。两端都为线程，并需要线程不断进行收发信息。客户端首先连接服务端获得socket，监听按键进行发包，并不断循环收取更新的地图信息进行打印。

服务端循环监听端口获得两个玩家的socket，每个socket配置一个管理员进行不断循环收取用户按键信息并更新游戏状态，同时每一次更新游戏状态向两个玩家发送地图信息。

## 实现步骤

首先，实现基础的界面绘制。

其次，实现基础的动作监听。

然后，实现敌方坦克的活动。

然后，增加箱子地形与相关碰撞判断。

然后，增加子弹实现。

然后，实现存档加载功能。

最后，编写网络通信。

## 主要类介绍

代码粘贴略，介绍可见B站视频